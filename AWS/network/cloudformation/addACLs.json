{
  "AWSTemplateFormatVersion": "2010-09-09",

  "Description": "Template to create a set of ACLs, and add them to an existing VPC. NOTE: The ID of the VPC to update is passed as a parameter from a calling CloudFormation stack. The Availability Zone, CIDR block, and Tag values are hardcoded herein.",

  "Metadata": {
      "Version": "1.0",
      "LastUpdated": "2017-10-31",
      "UpdatedBy": "Daren Westman (dwestman@trace3.com)"
  },

  "Parameters": {
    "VPCID": {
        "Type": "String",
        "Description": "ID of the VPC to modify"
    },
    "Environment" : {
      "Type" : "String",
      "Description" : "The environment where the resources will be built"
    },
    "Project" : {
      "Type" : "String",
      "Description" : "Project tag ('mh')"
    },
    "CidrList" : {
      "Type" : "CommaDelimitedList",
      "Description" : "A comma-delimited list of static IPs providing internal network access"
    }
  },

  "Resources": {
      "PrivateNetworkAcl": {
          "Type": "AWS::EC2::NetworkAcl",
          "Properties": {
              "VpcId": { "Ref": "VPCID" },
              "Tags": [
                  { "Key" : "Name", "Value" :  { "Fn::Join" : ["-", [ { "Ref" : "Project" }, "vpc", "nacl" ]] } },
                  { "Key": "Environment", "Value": { "Ref": "Environment" } },
                  { "Key": "Network", "Value": "Private" }
              ]
          }
      },
      "InboundAcl1": {
          "Type": "AWS::EC2::NetworkAclEntry",
          "Properties": {
              "NetworkAclId": { "Ref": "PrivateNetworkAcl" },
              "RuleNumber": "100",
              "Protocol": "-1",
              "RuleAction": "allow",
              "Egress": "false",
              "CidrBlock": "0.0.0.0/0",
              "PortRange": { "From": "0", "To": "65535" }
          }
      },

      "OutboundAcl1": {
          "Type": "AWS::EC2::NetworkAclEntry",
          "Properties": {
              "NetworkAclId": { "Ref": "PrivateNetworkAcl" },
              "RuleNumber": "100",
              "Protocol": "-1",
              "RuleAction": "allow",
              "Egress": "true",
              "CidrBlock": "0.0.0.0/0",
              "PortRange": { "From": "0", "To": "65535" }
          }
      }
  },

  "Outputs": {
    "VpcId": {
        "Description": "Id of the modified VPC",
        "Value": { "Ref": "VPCID" }
    },
    "NAVL": {
        "Description": "Id of the netowrk ACL",
        "Value": { "Ref": "PrivateNetworkAcl" }
    }
  }
}
