AWSTemplateFormatVersion: 2010-09-09
Description: Wrapper Template for Account Builder Scheduler
Parameters:
  sourcebucket:
    Description: "Source bucket where lambda function zip file is stored."
    Default : "organization-repo"
    Type: String
  SNSRegion:
    Description: "Region where SNS Topic is setup for account alerts"
    Default : "us-east-1"
    Type: String
  CGPrincipalID:
    Type: String
    Description: Principal ID of the master account.
    Default: 'o-1eax4cor5e'
  SQSRegionName:
    Default: us-east-1
    Type: String
  ProductEmailAlert:
    Type: String
    Description: Email address where SNS notifications will be sent.
    Default: 'shnc@capgroup.com'
  AlertSchedule:
    Default: cron(0/60 * * * ? *)
    Type: String
  SNOWAPIURL:
    Default: https://capitalgroupqa.service-now.com/api/cgm/incident
    Type: String
  SNOWParametersFile:
    Default: acctautomation/snow-module-parameters.json
    Type: String
  ServiceNowCredentials:
    Default: ServiceNowCredentials
    Type: String
  SecretsManagerRegion:
    Default: us-east-1
    Type: String
Resources:
  CFAccountBuilderStub:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      Parameters:
        sourcebucket: !Ref sourcebucket
        SNSRegion: !Ref SNSRegion
        CGPrincipalID: !Ref CGPrincipalID
        SQSRegionName: !Ref SQSRegionName
        ProductEmailAlert: !Ref ProductEmailAlert
        AlertSchedule: !Ref AlertSchedule
        SNOWAPIURL: !Ref SNOWAPIURL
        SNOWParametersFile: !Ref SNOWParametersFile
        ServiceNowCredentials: !Ref ServiceNowCredentials
        SecretsManagerRegion: !Ref SecretsManagerRegion
      Tags:
        - Key: cost-center
          Value: 524154
        - Key: ppmc-id
          Value: 69058
        - Key: usage-id
          Value: BB00000008
        - Key: toc 
          Value: ETOC
        - Key: exp-date
          Value: 99-00-9999
        - Key: env-type
          Value: ftdev
        - Key: sd-period
          Value: na   
        - Key: category
          Value: governance                                               
      TemplateURL: https://organization-repo.s3.amazonaws.com/servicecatalog/account-builder/scheduler/stub/CFAccountBuilderStub.yml